<button id="workCheckin">上班打卡</button>
<button id="workCheckout">下班打卡</button>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const urlParams = new URLSearchParams(window.location.search);
    const punchType = urlParams.get("type"); // work 或 off
    if (punchType) {
        document.getElementById(punchType === "work" ? "workCheckin" : "workCheckout").click();
    }
});

document.getElementById("workCheckin").addEventListener("click", function() {
    sendCheckin("上班");
});

document.getElementById("workCheckout").addEventListener("click", function() {
    sendCheckin("下班");
});

function sendCheckin(status) {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            let latitude = position.coords.latitude;
            let longitude = position.coords.longitude;
            let gpsData = `打卡|${status}|${latitude},${longitude}`;

            liff.sendMessages([
                {
                    type: "text",
                    text: gpsData
                }
            ]).then(() => {
                alert(`${status} 打卡成功！`);
                liff.closeWindow();
            }).catch(err => {
                console.error("打卡失敗", err);
                alert("打卡失敗，請重試！");
            });

        }, error => {
            alert("無法獲取 GPS 位置，請開啟 GPS！");
            console.error(error);
        });
    } else {
        alert("您的裝置不支援 GPS！");
    }
}
</script>
